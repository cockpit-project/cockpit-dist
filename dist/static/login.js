(()=>{"use strict";!function(t){let e,n;try{e=window.localStorage,window.localStorage.removeItem("url-root"),window.localStorage.removeItem("standard-login")}catch(n){e=window.sessionStorage,t.warn(String(n))}const o=window.environment||{},i=o.OAuth||null;i&&(i.TokenParam||(i.TokenParam="access_token"),i.ErrorParam||(i.ErrorParam="error_description"));const s=/\$\{([^}]+)\}|\$([a-zA-Z0-9_]+)/g;function r(t){const e=Array.prototype.slice.call(arguments,1);return t.replace(s,(function(t,n,o){return e[n||o]||""}))}function a(t){if(window.cockpit_po){const e=window.cockpit_po[t];if(e&&e[1])return e[1]}return t}const c=a;let l,u,d,g;const p=/[?&]?([^=]+)=([^&]*)/g;let w=null;function f(t){t=t.split("+").join(" ");const e={};for(;;){const n=p.exec(t);if(!n)break;e[decodeURIComponent(n[1])]=decodeURIComponent(n[2])}return e}function m(t){return document.getElementById(t)}function h(t,e){"string"==typeof t&&(t=[t]);for(let n=0;n<t.length;n++)if("string"==typeof t[n]){const o=document.querySelectorAll(t[n]);o&&o.forEach((function(t){t.hidden!==!!e&&(t.hidden=!!e)}))}else t[n].hidden!==!!e&&(t[n].hidden=!!e)}function v(){h(arguments,!1)}function y(){h(arguments,!0)}function k(e){window.console&&t.warn("fatal:",e),y("#login-again","#login-wait-validating"),w&&(m("login-again").href=w,v("#login-again")),y("#login","#login-details"),v("#login-fatal");const n=m("login-fatal-message");n.textContent="",n.appendChild(document.createTextNode(e))}function x(t,e){const n=m(t),o=n&&window.getComputedStyle?window.getComputedStyle(n,":before"):null;if(!o)return;let i=o.content;if(i&&"none"!=i&&"normal"!=i){const t=i.length;('"'===i[0]||"'"===i[0])&&t>2&&i[t-1]===i[0]&&(i=i.substr(1,t-2)),n.innerHTML=i||e}else n.removeAttribute("class")}function b(t){return t.replace(/^\s+|\s+$/g,"")}function C(t){const i=document.createElement("a");let s=document.baseURI;if(!s){const t=document.getElementsByTagName("base");s=t.length>0?t[0].href:"/"}t=t||"/",i.href=s,"/"!=i.pathname&&(n=i.pathname.replace(/^\/+|\/+$/g,""),e.setItem("url-root",n),n&&0===t.indexOf("/"+n)&&(t=t.replace("/"+n,"")||"/")),0===t.indexOf("/=")?(o.hostname=t.substring(2).split("/")[0],m("server-field").value=o.hostname,S(null,!0),t="/cockpit+"+t.split("/")[1]):0!==t.indexOf("/cockpit/")&&0!==t.indexOf("/cockpit+")&&(t="/cockpit"),u=t.split("/")[1],l="/"+u+"/login",n&&(l="/"+n+l),g=u,d=l}function S(t,e){t&&"keypress"===t.type&&" "!==t.key||(t&&"click"===t.type&&t.preventDefault(),void 0===e&&(e=m("server-group").hidden),h("#server-group",!e),m("option-group").setAttribute("data-state",e),e?(m("option-caret").classList.add("caret-down"),m("option-caret").classList.remove("caret-right")):(m("option-caret").classList.add("caret-right"),m("option-caret").classList.remove("caret-down")))}function I(){const t=window.location.href.split("#",2);w=i.URL,i.URL.indexOf("?")>-1?w+="&":w+="?",w+="redirect_uri="+encodeURIComponent(t[0])}function L(){y("#error-group"),m("login-error-message").textContent=""}function T(){y("#info-group"),m("login-info-message").textContent=""}function O(t,e){L(),t&&(i?k(t):(U(e||"login"),m("login-error-message").textContent=t,v("#error-group")))}function E(t){m("server-field").value?(L(),m("login-error-message").textContent=t,v("#error-group"),S(null,!0),U("login")):O(t)}function A(){return o.page.require_host&&-1===g.indexOf("cockpit+=")}function R(){O(null);const t=b(m("login-user-input").value);if(""===t)O(c("User name cannot be empty"));else if(A()&&""===m("server-field").value)O(c("Please specify the host to connect to"));else{const n=m("server-field").value;n?(u="cockpit+="+n,l=d.replace("/"+g+"/","/"+u+"/"),m("brand").style.display="none",m("badge").style.visibility="hidden"):(u=g,l=d,x("badge",""),x("brand","Cockpit")),m("server-name").textContent=n||o.hostname,m("login-button").removeEventListener("click",R);const i=m("login-password-input").value,s="superuser:"+t+(n?":"+n:""),r=e.getItem(s)||"none";e.setItem("superuser-key",s),e.setItem(s,r),e.setItem("standard-login",!0);const a={Authorization:"Basic "+window.btoa(N(t+":"+i)),"X-Superuser":r};n&&(a["X-SSH-Connect-Unknown-Hosts"]="yes"),q(0,a,!1)}}function U(t){const e=o.page.connect;let n=m("option-group").getAttribute("data-state");y("#login-wait-validating"),v("#login","#login-details"),h(["#user-group","#password-group"],"login"!=t),h("#conversation-group","conversation"!=t),h("#hostkey-group","hostkey"!=t),m("login-button-text").textContent=c("hostkey"==t?"Accept key and log in":"Log in"),m("login-password-input").value="",A()?(y("#option-group"),n=!0):h("#option-group",!e||"login"!=t),e&&"login"==t?h("#server-group",!n):y("#server-group"),m("login-button").removeAttribute("disabled"),m("login-button").removeAttribute("spinning"),m("login-button").classList.remove("pf-m-danger"),m("login-button").classList.add("pf-m-primary"),y("#get-out-link"),"login"==t&&m("login-button").addEventListener("click",R)}function H(t){var e;e=t,T(),e&&(m("login-info-message").textContent=e,v("#info-group")),m("server-name").textContent=document.title,function(t){const e=m("login-note");t?(v(e),e.textContent=t):e.innerHTML="&nbsp;"}(c("Log in with your server user account.")),m("login-user-input").addEventListener("keydown",(function(t){O(null),T(),13==t.which&&m("login-password-input").focus()}),!1),m("login-password-input").addEventListener("keydown",(function(t){O(null),13==t.which&&R()})),U("login"),m("login-user-input").focus()}function $(n){const o=function(){try{return JSON.parse(e.getItem("known_hosts")||"{ }")}catch(e){return t.warn("Can't parse known_hosts database in localStorage",e),{}}}(),i=n["host-key"],s=i.split(" ")[0],a=i.split(" ")[1];o[s]!=i?(o[s]?(m("hostkey-title").textContent=r(c("$0 key changed"),m("server-field").value),v("#hostkey-warning-group"),m("hostkey-message-1").textContent=""):(m("hostkey-title").textContent=c("New host"),y("#hostkey-warning-group"),m("hostkey-message-1").textContent=r(c("You are connecting to $0 for the first time."),m("server-field").value)),m("hostkey-verify-help-1").textContent=r(c("To verify a fingerprint, run the following on $0 while physically sitting at the machine or through a trusted network:"),m("server-field").value),m("hostkey-verify-help-cmds").textContent=r("ssh-keyscan$0 localhost | ssh-keygen -lf -",a?" -t "+a:""),m("hostkey-fingerprint").textContent=n.default,a?(m("hostkey-type").textContent=r("($0)",a),v("#hostkey-type")):y("#hostkey-type"),O(""),m("login-button").addEventListener("click",(function r(){m("login-button").removeEventListener("click",r),O(null,"hostkey"),o[s]=i,function(n){try{e.setItem("known_hosts",JSON.stringify(n))}catch(e){t.warn("Can't write known_hosts database to localStorage",e)}}(o),J(n.id,n.default)})),U("hostkey"),v("#get-out-link"),o[s]&&(m("login-button").classList.add("pf-m-danger"),m("login-button").classList.remove("pf-m-primary"))):J(n.id,n.default)}function _(t){if(t["host-key"])return void $(t);const e=t.echo?"text":"password";m("conversation-prompt").textContent=t.prompt;const n=m("conversation-message"),o=t.error||t.message;o?(n.textContent=o,v(n)):y(n);const i=m("conversation-input");function s(){m("conversation-input").removeEventListener("keydown",r),m("login-button").removeEventListener("click",s),O(null,"conversation"),J(t.id,m("conversation-input").value)}function r(t){O(null,"conversation"),13==t.which&&s()}i.value="",t.default&&(i.value=t.default),i.setAttribute("type",e),O(""),m("conversation-input").addEventListener("keydown",r),m("login-button").addEventListener("click",s),U("conversation"),i.focus()}function N(t){return window.unescape(encodeURIComponent(t))}function P(e,n){if(!e)return null;const o=e.split(" ");if("x-conversation"!==o[0].toLowerCase()&&3!=o.length)return null;const i=o[1];let s,r;try{s=window.atob(o[2])}catch(e){return window.console&&t.error("Invalid prompt data",e),null}try{r=JSON.parse(n)}catch(e){window.console&&t.log("Got invalid JSON response for prompt data",e),r={}}return r.id=i,r.prompt=s,r}function q(e,n,o){m("login-button").setAttribute("disabled","true"),m("login-button").setAttribute("spinning","true");const i=new XMLHttpRequest;i.open("GET",l,!0);for(const t in n)i.setRequestHeader(t,n[t]);i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status)M(JSON.parse(i.responseText));else if(401==i.status){const e=i.getResponseHeader("WWW-Authenticate");if(e&&0===e.toLowerCase().indexOf("x-conversation")){const t=P(e,i.responseText);t?_(t):k(c("Internal error: Invalid challenge header"))}else if(window.console&&t.log(i.statusText),i.statusText.indexOf("authentication-not-supported")>-1){const t=b(m("login-user-input").value);k(r(c("The server refused to authenticate '$0' using password authentication, and no other supported authentication methods are available."),t))}else i.statusText.indexOf("terminated")>-1?O(c("Authentication failed: Server closed connection")):i.statusText.indexOf("no-host")>-1?E(c("Unable to connect to that address")):i.statusText.indexOf("unknown-hostkey")>-1?E(c("Refusing to connect. Hostkey is unknown")):i.statusText.indexOf("unknown-host")>-1?E(c("Refusing to connect. Host is unknown")):i.statusText.indexOf("invalid-hostkey")>-1?E(c("Refusing to connect. Hostkey does not match")):O(c(o?"Authentication failed":"Wrong user name or password"))}else 403==i.status?O(decodeURIComponent(i.statusText)||c("Permission denied")):i.statusText?k(decodeURIComponent(i.statusText)):k(r(c("$0 error"),i.status))},i.send()}function J(t,e){q(0,{Authorization:"X-Conversation "+t+" "+window.btoa(N(e))},!0)}function W(t,e,n){let o=0;for(;o<t.length;){const i=t.key(o);n&&0!==i.indexOf("cockpit")||0===i.indexOf(e)?t.removeItem(i):o++}}function M(t){let i=window.sessionStorage.getItem("login-wanted");const s=m("server-field").value;s&&u!=g&&(i="/="+s,n&&(i="/"+n+i)),W(window.sessionStorage,u,!1),function(t){if(W(window.sessionStorage,u,!0),e.removeItem("login-data"),W(e,u,!1),t&&t["login-data"]){const n=JSON.stringify(t["login-data"]);e.setItem(u+"login-data",n),e.setItem("login-data",n)}n&&e.setItem("url-root",n);const i=o.CACertUrl;i&&window.sessionStorage.setItem("CACertUrl",i)}(t),function(t){let e=window.setTimeout((function(){e=null,window.location.reload(!0)}),100);t&&t!=window.location.href&&(window.location=t),window.onbeforeunload=function(){e&&window.clearTimeout(e),e=null}}(i)}t||(t=function(){}),window.onload=function(){window.onload=null,function(){if(!document.querySelectorAll)return;const t=document.querySelectorAll("[translate]");for(let e=0;e<t.length;e++)t[e].textContent=a(t[e].textContent)}(),window.cockpit_po&&window.cockpit_po[""]&&(document.documentElement.lang=window.cockpit_po[""].language||"en-us"),C(window.location.pathname),0!==window.location.pathname.indexOf("/"+n+"/cockpit/")&&0!==window.location.pathname.indexOf("/"+n+"/cockpit+")||document.documentElement.setAttribute("class","inline");let s=o.page.title;if(s&&0!==u.indexOf("cockpit+=")||(s=o.hostname),document.title=s,0===u.indexOf("cockpit+=")?y("#brand","#badge"):(x("badge",""),x("brand","Cockpit")),!function(){function e(e){"supports"===e&&(e="@supports API");const n=r(c("This web browser is too old to run the Web Console (missing $0)"),e);window.console&&t.warn(n),m("login-error-message").textContent=n,y("#login","#login-details"),v("#unsupported-browser","#error-group"),document.body.classList.add("brand-unsupported-browser")}function n(t,n){let o;try{o=n&&n[t]}catch(e){throw k(r(c("The web browser configuration prevents Cockpit from running (inaccessible $0)"),t)),e}return void 0!==o||(e(t),!1)}function o(){const t=[].join.call(arguments,": ");return!(!window.CSS||!window.CSS.supports.apply(this,arguments))||(e(t),!1)}return("MozWebSocket"in window||n("WebSocket",window))&&n("XMLHttpRequest",window)&&n("sessionStorage",window)&&n("JSON",window)&&n("defineProperty",Object)&&n("console",window)&&n("pushState",window.history)&&n("textContent",document)&&n("replaceAll",String.prototype)&&n("finally",Promise.prototype)&&n("supports",window.CSS)&&o("display","flex")&&o("display","grid")}())return;o.banner&&(v("#banner"),m("banner-message").textContent=o.banner.trimEnd()),m("show-other-login-options").addEventListener("click",S),m("show-other-login-options").addEventListener("keypress",S),m("server-clear").addEventListener("click",(function(){const t=m("server-field");t.value="",t.focus()}));const d=o["os-release"];d&&e.setItem("os-release",JSON.stringify(d));const g="explicit"==window.sessionStorage.getItem("logout-intent");g&&window.sessionStorage.removeItem("logout-intent");const p=window.sessionStorage.getItem("logout-reason");p&&window.sessionStorage.removeItem("logout-reason"),i?(y("#login-details","#login"),g?(I(),m("login-again").textContent=c("Login again"),k(c("Logout successful"))):function(){const t=document.createElement("a");if(!i.URL)return k(c("Cockpit authentication is configured incorrectly."));const e=!window.location.search&&window.location.hash?f(window.location.hash.slice(1)):f(window.location.search);if(I(),e[i.TokenParam]){window.sessionStorage.getItem("login-wanted")&&(t.href=window.sessionStorage.getItem("login-wanted"),C(t.pathname));const n=e[i.TokenParam];v("#login-wait-validating");const o=new XMLHttpRequest;o.open("GET",l,!0),o.setRequestHeader("Authorization","Bearer "+n),o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status)M(JSON.parse(o.responseText));else{const t=P(o.getResponseHeader("WWW-Authenticate"),o.responseText);t?_(t):k(decodeURIComponent(o.statusText))}},o.send()}else e[i.ErrorParam]?k(e[i.ErrorParam]):(window.sessionStorage.setItem("login-wanted",window.location.href),window.location=w)}()):g?H(p):function(){const t=new XMLHttpRequest;t.open("GET",l,!0),t.onreadystatechange=function(){4==t.readyState&&(200==t.status?M(JSON.parse(t.responseText)):401==t.status?H():t.statusText?k(decodeURIComponent(t.statusText)):0===t.status?H():k(r(c("$0 error"),t.status)))},t.send()}()}}(window.console)})();