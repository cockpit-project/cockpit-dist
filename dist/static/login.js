(()=>{"use strict";!function(e){var t,n;try{t=window.localStorage,window.localStorage.removeItem("url-root"),window.localStorage.removeItem("standard-login")}catch(n){t=window.sessionStorage,e.warn(String(n))}var o=window.environment||{},i=o.OAuth||null;i&&(i.TokenParam||(i.TokenParam="access_token"),i.ErrorParam||(i.ErrorParam="error_description"));var r=/\$\{([^}]+)\}|\$([a-zA-Z0-9_]+)/g;function a(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(r,(function(e,n,o){return t[n||o]||""}))}function s(e){if(window.cockpit_po){var t=window.cockpit_po[e];if(t&&t[1])return t[1]}return e}var l,u,c,d,g=s,p=/[?&]?([^=]+)=([^&]*)/g,w=null;function f(e){e=e.split("+").join(" ");for(var t,n={};t=p.exec(e);)n[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return n}function v(e){return document.getElementById(e)}function m(e,t){var n;"string"==typeof e&&(e=[e]);for(var o=0;o<e.length;o++)"string"==typeof e[o]?(n=document.querySelectorAll(e[o]))&&n.forEach((function(e){e.hidden!==!!t&&(e.hidden=!!t)})):e[o].hidden!==!!t&&(e[o].hidden=!!t)}function h(){m(arguments,!1)}function y(){m(arguments,!0)}function k(t){window.console&&e.warn("fatal:",t),y("#login-again","#login-wait-validating"),w&&(v("login-again").href=w,h("#login-again")),y("#login","#login-details"),h("#login-fatal");var n=v("login-fatal-message");n.textContent="",n.appendChild(document.createTextNode(t))}function x(e,t){var n,o=v(e);if(o&&window.getComputedStyle&&(n=window.getComputedStyle(o,":before")),n){var i,r=n.content;r&&"none"!=r&&"normal"!=r?(i=r.length,('"'===r[0]||"'"===r[0])&&i>2&&r[i-1]===r[0]&&(r=r.substr(1,i-2)),o.innerHTML=r||t):o.removeAttribute("class")}}function b(e){return e.replace(/^\s+|\s+$/g,"")}function C(e){var i,r=document.createElement("a"),a=document.baseURI;a||(a=(i=document.getElementsByTagName("base")).length>0?i[0].href:"/"),e=e||"/",r.href=a,"/"!=r.pathname&&(n=r.pathname.replace(/^\/+|\/+$/g,""),t.setItem("url-root",n),n&&0===e.indexOf("/"+n)&&(e=e.replace("/"+n,"")||"/")),0===e.indexOf("/=")?(o.hostname=e.substring(2).split("/")[0],v("server-field").value=o.hostname,S(null,!0),e="/cockpit+"+e.split("/")[1]):0!==e.indexOf("/cockpit/")&&0!==e.indexOf("/cockpit+")&&(e="/cockpit"),u=e.split("/")[1],l="/"+u+"/login",n&&(l="/"+n+l),d=u,c=l}function S(e,t){e&&"keypress"===e.type&&" "!==e.key||(e&&"click"===e.type&&e.preventDefault(),void 0===t&&(t=v("server-group").hidden),m("#server-group",!t),v("option-group").setAttribute("data-state",t),t?(v("option-caret").classList.add("caret-down"),v("option-caret").classList.remove("caret-right")):(v("option-caret").classList.add("caret-right"),v("option-caret").classList.remove("caret-down")))}function I(){var e=window.location.href.split("#",2);w=i.URL,i.URL.indexOf("?")>-1?w+="&":w+="?",w+="redirect_uri="+encodeURIComponent(e[0])}function L(){y("#error-group"),v("login-error-message").textContent=""}function T(){y("#info-group"),v("login-info-message").textContent=""}function O(e,t){L(),e&&(i?k(e):(U(t||"login"),v("login-error-message").textContent=e,h("#error-group")))}function E(e){v("server-field").value?(L(),v("login-error-message").textContent=e,h("#error-group"),S(null,!0),U("login")):O(e)}function A(){return o.page.require_host&&-1===d.indexOf("cockpit+=")}function R(){var e;O(null);var n=b(v("login-user-input").value);if(""===n)O(g("User name cannot be empty"));else if(A()&&""===v("server-field").value)O(g("Please specify the host to connect to"));else{(e=v("server-field").value)?(u="cockpit+="+e,l=c.replace("/"+d+"/","/"+u+"/"),v("brand").style.display="none",v("badge").style.visibility="hidden"):(u=d,l=c,x("badge",""),x("brand","Cockpit")),v("server-name").textContent=e||o.hostname,v("login-button").removeEventListener("click",R);var i=v("login-password-input").value,r="superuser:"+n+(e?":"+e:""),a=t.getItem(r)||"none";t.setItem("superuser-key",r),t.setItem(r,a),t.setItem("standard-login",!0);var s={Authorization:"Basic "+window.btoa(N(n+":"+i)),"X-Superuser":a};e&&(s["X-SSH-Connect-Unknown-Hosts"]="yes"),q(0,s,!1)}}function U(e){var t=o.page.connect,n=v("option-group").getAttribute("data-state");y("#login-wait-validating"),h("#login","#login-details"),m(["#user-group","#password-group"],"login"!=e),m("#conversation-group","conversation"!=e),m("#hostkey-group","hostkey"!=e),v("login-button-text").textContent=g("hostkey"==e?"Accept key and log in":"Log in"),v("login-password-input").value="",A()?(y("#option-group"),n=!0):m("#option-group",!t||"login"!=e),t&&"login"==e?m("#server-group",!n):y("#server-group"),v("login-button").removeAttribute("disabled"),v("login-button").removeAttribute("spinning"),v("login-button").classList.remove("pf-m-danger"),v("login-button").classList.add("pf-m-primary"),y("#get-out-link"),"login"==e&&v("login-button").addEventListener("click",R)}function H(e){var t;t=e,T(),t&&(v("login-info-message").textContent=t,h("#info-group")),v("server-name").textContent=document.title,function(e){var t=v("login-note");e?(h(t),t.textContent=e):t.innerHTML="&nbsp;"}(g("Log in with your server user account.")),v("login-user-input").addEventListener("keydown",(function(e){O(null),T(),13==e.which&&v("login-password-input").focus()}),!1),v("login-password-input").addEventListener("keydown",(function(e){O(null),13==e.which&&R()})),U("login"),v("login-user-input").focus()}function $(n){var o=function(){try{return JSON.parse(t.getItem("known_hosts")||"{ }")}catch(t){return e.warn("Can't parse known_hosts database in localStorage",t),{}}}(),i=n["host-key"],r=i.split(" ")[0],s=i.split(" ")[1];o[r]!=i?(o[r]?(v("hostkey-title").textContent=a(g("$0 key changed"),v("server-field").value),h("#hostkey-warning-group"),v("hostkey-message-1").textContent=""):(v("hostkey-title").textContent=g("New host"),y("#hostkey-warning-group"),v("hostkey-message-1").textContent=a(g("You are connecting to $0 for the first time."),v("server-field").value)),v("hostkey-verify-help-1").textContent=a(g("To verify a fingerprint, run the following on $0 while physically sitting at the machine or through a trusted network:"),v("server-field").value),v("hostkey-verify-help-cmds").textContent=a("ssh-keyscan$0 localhost | ssh-keygen -lf -",s?" -t "+s:""),v("hostkey-fingerprint").textContent=n.default,s?(v("hostkey-type").textContent=a("($0)",s),h("#hostkey-type")):y("#hostkey-type"),O(""),v("login-button").addEventListener("click",(function a(){v("login-button").removeEventListener("click",a),O(null,"hostkey"),o[r]=i,function(n){try{t.setItem("known_hosts",JSON.stringify(n))}catch(t){e.warn("Can't write known_hosts database to localStorage",t)}}(o),J(n.id,n.default)})),U("hostkey"),h("#get-out-link"),o[r]&&(v("login-button").classList.add("pf-m-danger"),v("login-button").classList.remove("pf-m-primary"))):J(n.id,n.default)}function _(e){if(e["host-key"])$(e);else{var t=e.echo?"text":"password";v("conversation-prompt").textContent=e.prompt;var n=v("conversation-message"),o=e.error||e.message;o?(n.textContent=o,h(n)):y(n);var i=v("conversation-input");i.value="",e.default&&(i.value=e.default),i.setAttribute("type",t),O(""),v("conversation-input").addEventListener("keydown",a),v("login-button").addEventListener("click",r),U("conversation"),i.focus()}function r(){v("conversation-input").removeEventListener("keydown",a),v("login-button").removeEventListener("click",r),O(null,"conversation"),J(e.id,v("conversation-input").value)}function a(e){O(null,"conversation"),13==e.which&&r()}}function N(e){return window.unescape(encodeURIComponent(e))}function P(t,n){var o,i,r,a;if(!t)return null;if("x-conversation"!==(o=t.split(" "))[0].toLowerCase()&&3!=o.length)return null;a=o[1];try{i=window.atob(o[2])}catch(t){return window.console&&e.error("Invalid prompt data",t),null}try{r=JSON.parse(n)}catch(t){window.console&&e.log("Got invalid JSON response for prompt data",t),r={}}return r.id=a,r.prompt=i,r}function q(t,n,o){v("login-button").setAttribute("disabled","true"),v("login-button").setAttribute("spinning","true");var i,r,s,u=new XMLHttpRequest;for(s in u.open("GET",l,!0),n)u.setRequestHeader(s,n[s]);u.onreadystatechange=function(){if(4==u.readyState)if(200==u.status)M(JSON.parse(u.responseText));else if(401==u.status)if((r=u.getResponseHeader("WWW-Authenticate"))&&0===r.toLowerCase().indexOf("x-conversation"))(i=P(r,u.responseText))?_(i):k(g("Internal error: Invalid challenge header"));else if(window.console&&e.log(u.statusText),u.statusText.indexOf("authentication-not-supported")>-1){var t=b(v("login-user-input").value);k(a(g("The server refused to authenticate '$0' using password authentication, and no other supported authentication methods are available."),t))}else u.statusText.indexOf("terminated")>-1?O(g("Authentication failed: Server closed connection")):u.statusText.indexOf("no-host")>-1?E(g("Unable to connect to that address")):u.statusText.indexOf("unknown-hostkey")>-1?E(g("Refusing to connect. Hostkey is unknown")):u.statusText.indexOf("unknown-host")>-1?E(g("Refusing to connect. Host is unknown")):u.statusText.indexOf("invalid-hostkey")>-1?E(g("Refusing to connect. Hostkey does not match")):O(g(o?"Authentication failed":"Wrong user name or password"));else 403==u.status?O(decodeURIComponent(u.statusText)||g("Permission denied")):u.statusText?k(decodeURIComponent(u.statusText)):k(a(g("$0 error"),u.status))},u.send()}function J(e,t){q(0,{Authorization:"X-Conversation "+e+" "+window.btoa(N(t))},!0)}function W(e,t,n){for(var o=0;o<e.length;){var i=e.key(o);n&&0!==i.indexOf("cockpit")||0===i.indexOf(t)?e.removeItem(i):o++}}function M(e){var i=window.sessionStorage.getItem("login-wanted"),r=v("server-field").value;r&&u!=d&&(i="/="+r,n&&(i="/"+n+i)),W(window.sessionStorage,u,!1),function(e){var i;W(window.sessionStorage,u,!0),t.removeItem("login-data"),W(t,u,!1),e&&e["login-data"]&&(i=JSON.stringify(e["login-data"]),t.setItem(u+"login-data",i),t.setItem("login-data",i)),n&&t.setItem("url-root",n);var r=o.CACertUrl;r&&window.sessionStorage.setItem("CACertUrl",r)}(e),function(e){var t=window.setTimeout((function(){t=null,window.location.reload(!0)}),100);e&&e!=window.location.href&&(window.location=e),window.onbeforeunload=function(){t&&window.clearTimeout(t),t=null}}(i)}e||(e=function(){}),window.onload=function(){window.onload=null,function(){if(document.querySelectorAll)for(var e=document.querySelectorAll("[translate]"),t=0;t<e.length;t++)e[t].textContent=s(e[t].textContent)}(),window.cockpit_po&&window.cockpit_po[""]&&(document.documentElement.lang=window.cockpit_po[""].language||"en-us"),C(window.location.pathname),0!==window.location.pathname.indexOf("/"+n+"/cockpit/")&&0!==window.location.pathname.indexOf("/"+n+"/cockpit+")||document.documentElement.setAttribute("class","inline");var r=o.page.title;if(r&&0!==u.indexOf("cockpit+=")||(r=o.hostname),document.title=r,0===u.indexOf("cockpit+=")?y("#brand","#badge"):(x("badge",""),x("brand","Cockpit")),function(){function t(t){"supports"===t&&(t="@supports API");var n=a(g("This web browser is too old to run the Web Console (missing $0)"),t);window.console&&e.warn(n),v("login-error-message").textContent=n,y("#login","#login-details"),h("#unsupported-browser","#error-group"),document.body.classList.add("brand-unsupported-browser")}function n(e,n){var o;try{o=n&&n[e]}catch(t){throw k(a(g("The web browser configuration prevents Cockpit from running (inaccessible $0)"),e)),t}return void 0!==o||(t(e),!1)}function o(){var e=[].join.call(arguments,": ");return!(!window.CSS||!window.CSS.supports.apply(this,arguments))||(t(e),!1)}return("MozWebSocket"in window||n("WebSocket",window))&&n("XMLHttpRequest",window)&&n("sessionStorage",window)&&n("JSON",window)&&n("defineProperty",Object)&&n("console",window)&&n("pushState",window.history)&&n("textContent",document)&&n("replaceAll",String.prototype)&&n("finally",Promise.prototype)&&n("supports",window.CSS)&&o("display","flex")&&o("display","grid")}()){o.banner&&(h("#banner"),v("banner-message").textContent=o.banner.trimEnd()),v("show-other-login-options").addEventListener("click",S),v("show-other-login-options").addEventListener("keypress",S),v("server-clear").addEventListener("click",(function(){var e=v("server-field");e.value="",e.focus()}));var c=o["os-release"];c&&t.setItem("os-release",JSON.stringify(c));var d="explicit"==window.sessionStorage.getItem("logout-intent");d&&window.sessionStorage.removeItem("logout-intent");var p,m=window.sessionStorage.getItem("logout-reason");m&&window.sessionStorage.removeItem("logout-reason"),i?(y("#login-details","#login"),d?(I(),v("login-again").textContent=g("Login again"),k(g("Logout successful"))):function(){var e=document.createElement("a");if(!i.URL)return k(g("Cockpit authentication is configured incorrectly."));var t,n,o,r=f(window.location.search);!window.location.search&&window.location.hash&&(r=f(window.location.hash.slice(1))),I(),r[i.TokenParam]?(window.sessionStorage.getItem("login-wanted")&&(e.href=window.sessionStorage.getItem("login-wanted"),C(e.pathname)),t=r[i.TokenParam],h("#login-wait-validating"),(o=new XMLHttpRequest).open("GET",l,!0),o.setRequestHeader("Authorization","Bearer "+t),o.onreadystatechange=function(){4==o.readyState&&(200==o.status?M(JSON.parse(o.responseText)):(n=P(o.getResponseHeader("WWW-Authenticate"),o.responseText))?_(n):k(decodeURIComponent(o.statusText)))},o.send()):r[i.ErrorParam]?k(r[i.ErrorParam]):(window.sessionStorage.setItem("login-wanted",window.location.href),window.location=w)}()):d?H(m):((p=new XMLHttpRequest).open("GET",l,!0),p.onreadystatechange=function(){4==p.readyState&&(200==p.status?M(JSON.parse(p.responseText)):401==p.status?H():p.statusText?k(decodeURIComponent(p.statusText)):0===p.status?H():k(a(g("$0 error"),p.status)))},p.send())}}}(window.console)})();