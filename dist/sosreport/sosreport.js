(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{const t=cockpit;var n=e.n(t);const o=function(){const e=n().dbus(null,{bus:"internal"}).proxy("cockpit.Superuser","/superuser");let t=!1;const o=()=>e.valid&&"init"!=e.Current?"none"!=e.Current:null,d={allowed:o(),reload_page_on_change:function(){t=!0}};function s(e){if(d.allowed!=e)if(null!=d.allowed&&t)window.location.reload(!0);else{const t=d.allowed;d.allowed=e,d.dispatchEvent("changed"),null!=t&&d.dispatchEvent("reconnect")}}return n().event_target(d),e.wait((()=>{if(!e.valid){const e=n().permission({admin:!0}),t=()=>{s(e.allowed)};e.addEventListener("changed",t),t()}})),e.addEventListener("changed",(()=>{s(o())})),d}(),d=n().gettext;let s,r,i;function l(){!function(){document.querySelector("#sos-progress .progress-bar").style.width="0%",document.getElementById("sos-download").setAttribute("hidden","hidden"),document.getElementById("sos-error").setAttribute("hidden","hidden"),document.getElementById("sos-cancel").textContent=d("Cancel"),r=null,i=[];const e=function(){const e=["sos","report","--batch","-v","-n","logs"],t=document.getElementById("sos-opts-form").elements;for(let n=0;n<t.length;n++)"checkbox"==t[n].type?t[n].checked&&e.push("--"+t[n].id.split("sos-")[1]):t[n].value&&(e.push("--"+t[n].id.split("sos-")[1]),e.push(t[n].value));return e}(),t=n().spawn(e,{superuser:!0,err:"out",pty:!0});s=t;let o="",l=0;const u=/Running ([0-9]+)\/([0-9]+):/,a=/Finishing plugins.*\[Running: (.*)\]/,m=/Starting ([0-9]+)\/([0-9]+).*\[Running: (.*)\]/,h=/Your sosreport has been generated and saved in:\s+(\/[^\r\n]+)/;t.stream((function(e){if(s==t){let t,n=0;o+=e;const d=o.split("\n");for(let e=d.length-1;e>=0;e--){if(t=m.exec(d[e])){l=parseInt(t[2],10),n=(parseInt(t[1],10)-t[3].split(" ").length)/l*100;break}if(t=a.exec(d[e])){n=l?(l-t[1].split(" ").length)/l*100:100;break}if(t=u.exec(d[e])){n=parseInt(t[1],10)/parseInt(t[2],10)*100;break}}document.getElementById("sos-alert").removeAttribute("hidden"),document.getElementById("sos-progress").removeAttribute("hidden"),document.querySelector("#sos-progress .progress-bar").style.width=n.toString()+"%"}})),t.done((function(){if(s==t){const e=h.exec(o);if(e){let t=e[1];const o=t.replace(/.*\//,"");0===t.indexOf("/host")&&(t=t.substr(5)),i=[t,t+".md5",t+".sha256"];const s=window.btoa(JSON.stringify({payload:"fsread1",binary:"raw",path:t,superuser:!0,max_read_size:157286400,external:{"content-disposition":'attachment; filename="'+o+'"',"content-type":"application/x-xz, application/octet-stream"}})),l=new URL(n().transport.uri("channel/"+n().transport.csrf_token)).pathname;r=l+"?"+s,document.getElementById("sos-progress").setAttribute("hidden","hidden"),document.getElementById("sos-error").setAttribute("hidden","hidden"),document.getElementById("sos-alert").removeAttribute("hidden"),document.getElementById("sos-download").removeAttribute("hidden"),document.getElementById("sos-cancel").textContent=d("Close")}else c(d("No archive has been created."),o);s=null}})),t.fail((function(e){s==t&&(c(e.toString(),o),s=null)}))}()}function c(e,t){document.getElementById("sos-alert").setAttribute("hidden","hidden"),document.getElementById("sos-progress").setAttribute("hidden","hidden"),document.getElementById("sos-download").setAttribute("hidden","hidden"),document.querySelector("#sos-error .alert-message").textContent=e;const n=document.getElementById("sos-error-extra");t?(n.textContent=t,n.removeAttribute("hidden")):n.setAttribute("hidden","hidden"),document.getElementById("sos-cancel").textContent=d("Close"),document.getElementById("sos-error").removeAttribute("hidden")}function u(){s&&(s.close("cancelled"),s=null),i.length>0&&n().spawn(["rm"].concat(i),{superuser:!0,err:"message"}).fail((function(e){console.log("failed to remove",i,e)})),r=null,i=[],document.getElementById("sos").setAttribute("hidden","hidden")}function a(){const e=document.createElement("iframe");e.setAttribute("src",r),e.setAttribute("hidden","hidden"),e.addEventListener("load",(()=>{const t=e.contentDocument.title;t&&c(t)})),document.body.appendChild(e)}document.addEventListener("DOMContentLoaded",(()=>{function e(){document.getElementById("switch-instructions").style.display=!1===o.allowed?"block":"none",o.allowed?document.getElementById("create-button").removeAttribute("hidden"):document.getElementById("create-button").setAttribute("hidden","hidden")}document.getElementById("create-button").addEventListener("click",(()=>{document.getElementById("sos-options-menu").removeAttribute("hidden")})),document.getElementById("sos-options-close-button").addEventListener("click",(()=>{document.getElementById("sos-options-menu").setAttribute("hidden","hidden")})),document.getElementById("sos-options-cancel").addEventListener("click",(()=>{document.getElementById("sos-options-menu").setrAttribute("hidden","hidden")})),document.getElementById("sos-options-run").addEventListener("click",(()=>{document.getElementById("sos-options-menu").setAttribute("hidden","hidden"),document.getElementById("sos").removeAttribute("hidden"),l()})),document.getElementById("sos-cancel").addEventListener("click",u),document.querySelector("#sos-download button").addEventListener("click",a),n().translate(),document.body.removeAttribute("hidden"),o.addEventListener("changed",e),e(),n().transport.wait((()=>{}))}))})()})();